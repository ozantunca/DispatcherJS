(function(){var l={each:function(a,c){for(var b=a.length;0!==b--;)c(a[b],b)}},d=function(){this._listeners=[];this._maxListeners=10};d.prototype._parseListener=function(a,c){var b={fn:c};if("function"==typeof a)b.fn=a;else if(Array.isArray(a))b.dependencies=a;else if("string"==typeof a)b.dependencies=[a];else throw Error("EventHandler is not a function.");return b};d.prototype.removeAllListeners=function(a){if(a||0==a)return this.off(a);this._listeners=[]};d.prototype.setMaxListeners=function(a){this._maxListeners=
a};d.prototype.on=function(a,c,b,d){"string"!==typeof a&&(a=a.toString());this.listeners(a).length>=this._maxListeners||(b=this._parseListener(c,b),b.eventName=a,d&&(b.once=!0),this._listeners.push(b),"newListener"!=a&&this.emit("newListener",b.fn))};d.prototype.once=function(a,c,b){this.on(a,c,b,!0)};d.prototype.off=function(a,c){if("undefined"!==typeof a)if(c)for(var b=this._listeners.length;b--;)a==this._listeners[b].eventName&&this._listeners[b].fn===c&&(this.emit("removeListener",this._listeners[b].fn),
this._listeners.splice(b,1));else for(b=this._listeners.length;b--;)a==this._listeners[b].eventName&&(this.emit("removeListener",this._listeners[b].fn),this._listeners.splice(b,1))};d.prototype.listeners=function(a){if(!a)return this._listeners;var c=a.split(".");a=c[0];var b=c[1]?"."+c[1]:null,d,c=[];d=b?this._matchWithNamespace:this._matchEvent;if("function"==typeof this._listeners.filter)return this._listeners.filter(function(c){return d(a,c.eventName,b)});for(var e=0;e<this._listeners;e++)d(a,
listener.eventName,b)&&c.push(listener);return c};d.prototype._matchWithNamespace=function(a,c,b){return a==c||a+b==c||0==a.indexOf(c+":")||c==b||"*"==c||0==a.indexOf(c.substring(0,c.indexOf("."))+":")};d.prototype._matchEvent=function(a,c){return a==c||0==a.indexOf(c+":")||0==c.indexOf(a+".")||"*"==c||0==a.indexOf(c.substring(0,c.indexOf("."))+":")};d.prototype._matchArray=function(a,c){var b,d;if(-1!=c.indexOf(".")){b=c.split(".");c=b[0];var e=b[1]?"."+b[1]:null;b=this._matchWithNamespace}else b=
this._matchEvent;for(;d=a.pop();)if(b(c,d.eventName,e)||d.eventName.substring(d.eventName.indexOf("."))==e&&"*"!=d.eventName)return!0;return!1};d.prototype._deferredLoop=function(a,c,b){var d,e,f,k=this,g=0;for(d=g=a.length;e=a.pop();){if(0==g)if(c)break;else throw Error("Deadlock!");f=!1;if(e.dependencies){for(var h=0;h<e.dependencies.length;h++)f=k._matchArray(a.slice(),e.dependencies[h])?!0:f;f?a.unshift(e):(f=e.fn(b))&&f.then&&(c++,a.unshift(e),f.then(function(){c--;k._deferredLoop(a,c,b)}));
a.length==d?g--:d=g=a.length}else a.unshift(e),g--}};d.prototype.emit=function(a){if(!a)throw Error("Nothing to emit.");"string"!==typeof a&&(a=a.toString());var c=[],b=this._listeners.slice(),d=0,e=this,f={arguments:"object"==typeof arguments?Array.prototype.slice.call(arguments,1):[],event:a,stopPropagation:function(){b=[];c=[]}},k,g;if(-1!=a.indexOf(".")){var h=a.split(".");a=h[0];var m=h[1]?"."+h[1]:null;k=e._matchWithNamespace}else k=e._matchEvent;if(!a)throw Error("Nothing to emit.");l.each(b,
function(b,h){k(a,b.eventName,m)&&(b.dependencies?c.push(b):((g=b.fn(f))&&g.then&&(d++,c.push(b),g.then(function(){d--;e._deferredLoop(c,d,f)})),b.once&&e._listeners.splice(h,1)))});0<c.length&&e._deferredLoop(c,d,f)};d.prototype.applyEmit=function(a){var c=this,b="object"==typeof arguments?Array.prototype.slice.call(arguments,0):[];return function(){c.emit.apply(c,b)}};d.prototype.removeListener=d.prototype.off;d.prototype.addListener=d.prototype.on;"object"===typeof exports?module.exports=d:"function"===
typeof define&&define.amd?define(function(){return d}):window.Dispatcher=d})();
