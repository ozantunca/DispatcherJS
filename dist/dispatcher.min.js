var dispatcher={_listeners:[],_parseListener:function(e,t){if("function"==typeof e)t=e;else if(Array.isArray(e))t.dependencies=e;else{if("string"!=typeof e)throw Error("EventHandler is not a function.");t.dependencies=[e]}return t},removeAllListeners:function(e){return e||0==e?this.off(e):void(this._listeners=[])},on:function(e,t,n){n=this._parseListener(t,n),n.eventName=e,this._listeners.push(n)},once:function(e,t,n){n=this._parseListener(t,n),n.eventName=e,n.once=!0,this._listeners.push(n)},off:function(e,t){if(void 0!==e)if(t)for(var n=0;n<this._listeners.length;n++)e==this._listeners[n].eventName&&this._listeners[n]===t&&this._listeners.splice(n,1);else for(var n=0;n<this._listeners.length;n++)e==this._listeners[n].eventName&&this._listeners.splice(n,1)},listeners:function(e){var t=e.split("."),e=t[0],n=t[1]?"."+t[1]:null,i=[];if(_match=n?this._matchWithNamespace:this._matchEvent,"function"==typeof this._listeners.filter)return this._listeners.filter(function(t){_match(e,t.eventName,n)});for(var s=0;s<this._listeners;s++)_match(e,listener.eventName,n)&&i.push(listener);return i},_matchWithNamespace:function(e,t,n){return e==t||t==n||"*"==t},_matchEvent:function(e,t){return e==t||t.indexOf(e+".")>-1||"*"==t},_matchArray:function(e,t){var n;if(-1!=t.indexOf(".")){var i=t.split("."),t=i[0],s=i[1]?"."+i[1]:null;n=this._matchWithNamespace}else n=this._matchEvent;for(;listener=e.pop();)if(n(t,listener.eventName,s)||listener.eventName.substring(listener.eventName.indexOf("."))==s&&"*"!=listener.eventName)return!0;return!1},emit:function(e){if(!e)return Error("Nothing to emit.");var t,n,i=[],s=this._listeners.slice();if(-1!=e.indexOf(".")){var r=e.split("."),e=r[0],a=r[1]?"."+r[1]:null;n=this._matchWithNamespace}else n=this._matchEvent;if(!e)return Error("Nothing to emit.");for(;t=s.pop();){if(n(e,t.eventName,a)){if(t.dependencies){i.push(t);continue}arguments.length>1?t.apply(null,arguments):t()}t.once&&this._listeners.splice(s.length,1)}if(i.length>0)for(;t=i.pop();){dependent=!1;for(var h=0;h<t.dependencies.length;h++)dependent=this._matchArray(i.slice(),t.dependencies[h])?!0:dependent;dependent?i.unshift(t):arguments.length>1?t.apply(null,arguments):t()}}};dispatcher.removeListener=dispatcher.off,dispatcher.addListener=dispatcher.on,module.exports=dispatcher;
